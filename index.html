<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>DoSnapshot by merqlove</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>DoSnapshot</h1>
        <h2>A command-line snapshot maker for your DigitalOcean droplets. Fully Automated. Multi-threaded.</h2>
        <a href="https://github.com/merqlove/do_snapshot" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p><a href="https://gitter.im/merqlove/do_snapshot?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Join the chat at https://gitter.im/merqlove/do_snapshot"></a>
<a href="https://www.digitalocean.com/community/projects/dosnapshot">Project Page at Digital Ocean</a>, comment or vote for this project.</p>

<p><a href="http://badge.fury.io/rb/do_snapshot"><img src="https://badge.fury.io/rb/do_snapshot.svg" alt="Gem Version"></a>
<a href="https://travis-ci.org/merqlove/do_snapshot"><img src="https://travis-ci.org/merqlove/do_snapshot.svg?branch=master" alt="Build Status"></a>
<a href="https://gemnasium.com/merqlove/do_snapshot"><img src="https://gemnasium.com/merqlove/do_snapshot.svg" alt="Dependency Status"></a>
<a href="https://coveralls.io/r/merqlove/do_snapshot?branch=master"><img src="https://coveralls.io/repos/merqlove/do_snapshot/badge.png?branch=master" alt="Coverage Status"></a>
<a href="http://inch-ci.org/github/merqlove/do_snapshot"><img src="http://inch-ci.org/github/merqlove/do_snapshot.png?branch=master" alt="Inline docs"></a>
<a href="https://codeclimate.com/github/merqlove/do_snapshot"><img src="https://codeclimate.com/github/merqlove/do_snapshot.png" alt="Code Climate"></a></p>

<p>Use this tool to backup DigitalOcean droplet's via snapshot method, on the fly!</p>

<h2>
<a id="api-changes" class="anchor" href="#api-changes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API Changes:</h2>

<ul>
<li>03.08.16: DO now automagically keeps our droplets running when snapshot is processing, so:<br>
Added options <code>--shutdown</code>, <code>--no-shutdown</code>.<br>
<code>shutdown</code> now disabled by default, no downtime anymore, <code>YES</code>!<br>
If you want <code>shutdown</code> back use <code>--shutdown</code> option.</li>
<li>08.01.16: now we have to use DO API V2 only, because V1 is not work anymore.</li>
<li>17.10.15: now we use DO API V2 by default, due V1 deprecation at 11.2015.</li>
</ul>

<p>Here are some features:</p>

<ul>
<li>Multiple threads out of the box, no matter how many droplets you have.</li>
<li>Snapshots Auto-Cleanup.</li>
<li>Auto-Boot Droplet if Snapshot Event fails or encounters a bad connection exception.</li>
<li>Special binaries for cron and command-line, Homebrew, and standalone installers.</li>
<li>Mail notifications when a snapshot fails or the maximum number of snapshots is reached for a droplet or droplets.</li>
<li>Custom mail settings (You can set <a href="https://github.com/benprew/pony">Pony</a> mail settings).</li>
<li>Stop mode (automatically stop creating new snapshots when the maximum is reached).</li>
<li>Timeout option for long requests or uncaught loops. Defaults to 600 seconds, but can be changed.</li>
<li>Logging into selected directory.</li>
<li>Verbose mode for research.</li>
<li>Quiet mode for silence.</li>
</ul>

<h2>
<a id="compatibility" class="anchor" href="#compatibility" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Compatibility</h2>

<p>Ruby versions 1.9.3 and higher. JRuby 1.7, 9.0.0.0 or later is also supported.</p>

<p><img src="https://raw.githubusercontent.com/merqlove/do_snapshot/master/assets/example.png" alt="DoSnaphot example"></p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>Install it yourself as:</p>

<pre><code>$ gem install do_snapshot
</code></pre>

<p>System Wide Install (OSX, *nix):</p>

<pre><code>$ sudo gem install do_snapshot
</code></pre>

<p>For <strong>OSX</strong> users (<a href="http://github.com/merqlove/homebrew-do-snapshot">Homebrew Tap</a>):</p>

<pre><code>$ brew tap merqlove/do-snapshot &amp;&amp; brew install do_snapshot

$ do_snapshot -V
</code></pre>

<p>Standalone with one-liner:</p>

<pre><code>$ wget https://assets.merqlove.ru.s3.amazonaws.com/do_snapshot/do_snapshot.tgz &amp;&amp; sudo tar -xzf do_snapshot.tgz /usr/local/lib/ &amp;&amp; sudo ln -s /usr/local/lib/do_snapshot/bin/do_snapshot /usr/local/bin/do_snapshot
</code></pre>

<p>Standalone pack for <strong>Unix/Linux</strong> users: <a href="https://assets.merqlove.ru.s3.amazonaws.com/do_snapshot/do_snapshot.tgz">Download</a></p>

<pre><code>$ wget https://assets.merqlove.ru.s3.amazonaws.com/do_snapshot/do_snapshot.tgz # if not done.

# Example Install into /usr/local

$ tar -xzf do_snapshot.tgz /usr/local/ &amp;&amp; ln -s /usr/local/do_snapshot/bin/do_snapshot /usr/local/bin/do_snapshot 
$ do_snapshot help      
</code></pre>

<p>Standalone Zip pack for others: <a href="https://assets.merqlove.ru.s3.amazonaws.com/do_snapshot/do_snapshot.zip">Download</a></p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<p>Mainly it's pretty simple:</p>

<pre><code>$ do_snapshot --only 123456 -k 5 -c -v
</code></pre>

<h3>
<a id="setup" class="anchor" href="#setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setup</h3>

<h3>
<a id="digitalocean-api-v2-default" class="anchor" href="#digitalocean-api-v2-default" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Digitalocean API V2 (default):</h3>

<p>You'll need to generate an access token in Digital Ocean's control panel at <a href="https://cloud.digitalocean.com/settings/applications">https://cloud.digitalocean.com/settings/applications</a></p>

<pre><code>$ export DIGITAL_OCEAN_ACCESS_TOKEN="SOMETOKEN"
</code></pre>

<p>If you want to set keys without environment, than set it via options when you run do_snapshot:</p>

<pre><code>$ do_snapshot --digital-ocean-access-token YOURLONGTOKEN   
</code></pre>

<h3>
<a id="how-to" class="anchor" href="#how-to" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How-To</h3>

<h5>
<a id="tutorials" class="anchor" href="#tutorials" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tutorials:</h5>

<ul>
<li><a href="https://longren.io/automate-making-snapshots-of-your-digitalocean-droplets/">Automate Taking Snapshots of Your DigitalOcean Droplets with DOSnapshot
, Tyler Longren</a></li>
<li><a href="http://www.ashout.com/automate-digital-ocean-droplet-snaphot/">How to Automate Taking Digital Ocean Droplet Snaphot with DoSnapShot Script, Arun Kumar</a></li>
</ul>

<p>Here we <code>keeping</code> only 5 <strong>latest</strong> snapshots and cleanup older after new one is created. If creation of snapshots failed no one will be deleted. By default we keeping <code>10</code> droplets.</p>

<pre><code>$ do_snapshot --keep 5 -c
</code></pre>

<p>Keep latest 3 from selected droplet:</p>

<pre><code>$ do_snapshot --only 123456 --keep 3
</code></pre>

<p>Working with all except droplets:</p>

<pre><code>$ do_snapshot --exclude 123456 123457
</code></pre>

<p>Keep latest 5 snapshots, send mail notification instead of creating new one:</p>

<pre><code>$ do_snapshot --keep 10 --stop --mail to:yourmail@example.com
</code></pre>

<p><img src="https://raw.githubusercontent.com/merqlove/do_snapshot/master/assets/safe_mode.png" alt="DoSnapshot Safe Mode Example"></p>

<p>E-mail notifications disabled out of the box. 
For working mailer you need to set e-mail settings via run options.</p>

<pre><code>--mail to:mail@somehost.com from:from@host.com --smtp address:smtp.gmail.com port:25 user_name:someuser password:somepassword
</code></pre>

<h3>
<a id="cron-example" class="anchor" href="#cron-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cron example</h3>

<pre><code>0 4 * * 7 . /.../.digitalocean_keys &amp;&amp; /.../bin/do_snapshot -k 5 -m to:TO from:FROM -t address:HOST user_name:LOGIN password:PASSWORD port:2525 -q -c
</code></pre>

<h3>
<a id="real-world-example" class="anchor" href="#real-world-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Real world example</h3>

<pre><code>$ bin/do_snapshot --only 123456 -k 3 -c -m to:TO from:FROM -t address:HOST user_name:LOGIN password:PASSWORD port:2525 -v

Checking DigitalOcean Id's.
Start performing operations
Setting DigitalOcean Id's.
Loading list of DigitalOcean droplets
Working with list of DigitalOcean droplets
Preparing droplet id: 123456 name: mrcr.ru to take snapshot.
Shutting down droplet.
Start creating snapshot for droplet id: 123456 name: mrcr.ru.
Wait until snapshot will be created.
Snapshot name: mrcr.ru_2014_07_18 created successfully.
Droplet id: 123456 name: mrcr.ru snapshots: 4.
For droplet with id: 123456 and name: mrcr.ru the maximum number 3 of snapshots is reached.
Cleaning up snapshots for droplet id: 123456 name: mrcr.ru.
Snapshot name: mrcr.ru_2014_07_17 delete requested.
All operations has been finished.
Sending e-mail notification.
</code></pre>

<h3>
<a id="all-options" class="anchor" href="#all-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>All options:</h3>

<pre><code>&gt; $ do_snapshot c  

aliases: s, snap, create

Options:
  -p, [--protocol=1]                                             # Select api version.
                                                                 # Default: 2
      [--shutdown], [--no-shutdown]                              # Check if you want to stop your droplet before the snapshot.
  -o, [--only=123456 123456 123456]                              # Select some droplets.
  -e, [--exclude=123456 123456 123456]                           # Except some droplets.
  -k, [--keep=5]                                                 # How much snapshots you want to keep?
                                                                 # Default: 10
  -d, [--delay=5]                                                # Delay between snapshot operation status requests.
                                                                 # Default: 10                                                                    
      [--timeout=250]                                            # Timeout in sec's for events like Power Off or Create Snapshot.
                                                                 # Default: 3600                                                                     
  -m, [--mail=to:yourmail@example.com]                           # Receive mail if fail or maximum is reached.
  -t, [--smtp=user_name:yourmail@example.com password:password]  # SMTP options.
  -l, [--log=/Users/someone/.do_snapshot/main.log]               # Log file path. By default logging is disabled.
  -c, [--clean], [--no-clean]                                    # Cleanup snapshots after create. If you have more images than you want to `keep`, older will be deleted.
  -s, [--stop], [--no-stop]                                      # Stop creating snapshots if maximum is reached.
      [--stop-by-power], [--no-stop-by-power]                    # Droplet stop method, by it's power status (instead of waiting for event completed state).
  -v, [--trace], [--no-trace]                                    # Verbose mode.
  -q, [--quiet], [--no-quiet]                                    # Quiet mode. If don't need any messages in console.
      [--digital-ocean-access-token=YOURLONGAPITOKEN]            # DIGITAL_OCEAN_ACCESS_TOKEN. if you can't use environment.
      [--digital-ocean-client-id=YOURLONGAPICLIENTID]            # DIGITAL_OCEAN_CLIENT_ID. if you can't use environment.
      [--digital-ocean-api-key=YOURLONGAPIKEY]                   # DIGITAL_OCEAN_API_KEY. if you can't use environment.    

Description:
  `do_snapshot` able to create and cleanup snapshots on your droplets.

  You can optionally specify parameters to select or exclude some droplets.   
</code></pre>

<h2>
<a id="you-can-ask-why-you-made-this-tool" class="anchor" href="#you-can-ask-why-you-made-this-tool" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>You can ask, "Why you made this tool?"</h2>

<ul>
<li>First. I needed stable tool, which can provide for me automatic Snapshot feature for all of my Droplets via Cron planner.</li>
<li>I don't want to think how much snapshots for each droplet i have.</li>
<li>I don't wont to sleep when my droplets Offline!!! And i wanted tool which can BOOT back droplets, which failed to snapshot.</li>
<li>Also i want to understand what's going on if there some error. Mail is my choice. But logs also good.</li>
<li>And ... sure ;) We want to do it fast as rocket! :)</li>
<li>more more more...</li>
<li>So this tool can save a lot of time for people.</li>
</ul>

<h2>
<a id="donating" class="anchor" href="#donating" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Donating:</h2>

<p>Support this project and others by <a href="https://gratipay.com/%7Emerqlove/">merqlove</a> via <a href="https://gratipay.com/%7Emerqlove/">gratipay</a>.<br>
<a href="https://gratipay.com/merqlove/"><img src="https://cdn.rawgit.com/gratipay/gratipay-badge/2.3.0/dist/gratipay.png" alt="Support via Gratipay"></a></p>

<h2>
<a id="dependencies" class="anchor" href="#dependencies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dependencies:</h2>

<ul>
<li>
<a href="https://github.com/erikhuda/thor">Thor</a> for CLI.</li>
<li>
<a href="https://github.com/blom/barge">Barge</a> for API V2 requests.</li>
<li>
<a href="https://github.com/benprew/pony">Pony</a> for mail notifications.</li>
</ul>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributing</h2>

<ol>
<li>Fork it ( <a href="https://github.com/merqlove/do_snapshot/fork">https://github.com/merqlove/do_snapshot/fork</a> )</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create a new Pull Request</li>
</ol>

<h3>
<a id="testing" class="anchor" href="#testing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Testing</h3>

<pre><code>$ rake spec 
</code></pre>

<p>Copyright (c) 2015 Alexander Merkulov</p>

<p>MIT License</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/merqlove/do_snapshot/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/merqlove/do_snapshot/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/merqlove/do_snapshot"></a> is maintained by <a href="https://github.com/merqlove">merqlove</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-52965116-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
